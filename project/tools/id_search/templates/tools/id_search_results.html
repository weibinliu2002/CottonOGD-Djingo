{% extends 'home/base.html' %}

{% block content %}
<div class="container">
    <h1 class="text-center my-4">Gene ID Search Results</h1>

    <div class="text-center mb-4">
        <a href="{% url 'tools_id_search:id_search' %}" class="btn btn-primary">New Search</a>
    </div>

    <div class="table-responsive">
        <table class="table table-bordered">
            <thead>
                <tr class="text-center">
                    <th style="width: 16.66%">Query ID</th>
                    <th style="width: 16.66%">Row Name</th>
                    <th style="width: 16.66%">Column Name</th>
                    <th style="width: 50%">All IDs in Cell</th>
                </tr>
            </thead>
            <tbody>
                {% for result in results %}
                <tr>
                    <td class="text-center align-middle" style="width: 16.66%">
                        {% if result.is_combined %}
                            <span class="combined-id">{{ result.query_id }}</span>
                        {% else %}
                            {{ result.query_id }}
                        {% endif %}
                    </td>
                    <td class="text-center align-middle" style="width: 16.66%">{{ result.row_name }}</td>
                    <td class="text-center align-middle" style="width: 16.66%">{{ result.column_name }}</td>
                    <td class="text-center" style="width: 50%">
                        <div class="d-inline-block text-left">
                            {% with ids=result.all_ids.split %}
                                {% if ids|length > 2 %}
                                    <span class="visible-ids">{{ ids.0 }}, {{ ids.1 }}</span>
                                    <span class="hidden-ids" style="display:none;">, {{ ids|slice:"2:"|join:", " }}</span>
                                    <button class="toggle-ids-btn" onclick="toggleIDs(this)">展开</button>
                                {% else %}
                                    {{ result.all_ids }}
                                {% endif %}
                            {% endwith %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
    .combined-id {
        color: blue;
        font-weight: bold;
    }
    .toggle-ids-btn {
        margin-left: 5px;
        cursor: pointer;
        background: #f9f8f8;
        border: 1px solid #ccc;
        border-radius: 3px;
        padding: 0 5px;
    }
    .toggle-ids-btn:hover {
        background: #e0e0e0;
    }
    table {
        table-layout: fixed;
    }
    th, td {
        vertical-align: middle !important;
    }
</style>

<script>
    function toggleIDs(button) {
        const hiddenIDs = button.previousElementSibling;
        if (hiddenIDs.style.display === 'none') {
            hiddenIDs.style.display = 'inline';
            button.textContent = '收起';
        } else {
            hiddenIDs.style.display = 'none';
            button.textContent = '展开';
        }
    }
</script>
{% endblock %}